{"version":3,"sources":["../../src/history/History.js"],"names":["toAction","toEntries","createActionRef","cleanBasename","isAction","createPrevEmpty","History","routes","options","basenames","map","bn","kind","_restore","n","index","entries","action","info","commit","firstAction","_notify","dispatch","getLocation","unlisten","notify","extras","n2","length","_once","location","path","state","_findAdjacentN","jump","undefined","_pushToFront","awaitUrl","url","_push","slice","currUrl","_replace","delta","byIndex","act","revertPop","_resolveDelta","isMovingAdjacently","isPop","Error","_transformEntry","currentEntry","prev","_createPrev","oldUrl","_jump","i","entry","_set","prevUrl","newInfo","ents","_findResetFirstAction","unshift","oldFirstUrl","reverseN","_reset","from","params","query","hash","basename","scene","type","resetFirstEntry","homeType","Object","keys","find","Array","isArray","notFoundPath","NOT_FOUND","homeRoute","committed","Promise","resolve","then","save","_findBackN","_findNextN","e","prevEntries","isBehindHead","entriesToDelete","splice","push","findIndex","key"],"mappings":"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","sourcesContent":["import {\n  toAction,\n  toEntries,\n  createActionRef,\n  cleanBasename,\n  isAction,\n} from '../utils'\nimport { createPrevEmpty } from '../core/createReducer'\n\nexport default class History {\n  constructor(routes, options = {}) {\n    this.routes = routes\n    this.options = options\n\n    options.basenames = (options.basenames || []).map((bn) => cleanBasename(bn))\n\n    const kind = 'load'\n    const { n, index, entries } = this._restore() // delegate to child classes to restore\n    const action = entries[index]\n    const info = { kind, n, index, entries }\n    const commit = function() {} // action already committed, by virtue of browser loading the URL\n\n    this.firstAction = this._notify(action, info, commit, false)\n  }\n\n  // CORE:\n\n  listen(dispatch, getLocation) {\n    this.dispatch = dispatch\n    this.getLocation = getLocation\n    return () => this.unlisten()\n  }\n\n  unlisten() {\n    this.dispatch = null\n  }\n\n  _notify(action, info, commit, notify = true, extras) {\n    const { index, entries, n } = info\n    const n2 =\n      n || (index > this.index ? 1 : index === this.index ? this.n : -1)\n    const { length } = entries\n\n    action = {\n      ...action,\n      ...extras,\n      commit: this._once(commit),\n      location: { ...action.location, ...info, length, n: n2 },\n    }\n\n    if (notify && this.dispatch) return this.dispatch(action)\n    return action\n  }\n\n  // LOCATION STATE GETTERS (single source of truth, unidirectional):\n\n  get location() {\n    return this.getLocation()\n  }\n\n  get entries() {\n    return this.location.entries\n  }\n\n  get index() {\n    return this.location.index\n  }\n\n  get url() {\n    return this.location.url\n  }\n\n  get n() {\n    return this.location.n\n  }\n\n  get prevUrl() {\n    return this.location.prev.location.url\n  }\n\n  // API:\n\n  push(path, state = path.state || {}, notify = true) {\n    const action = toAction(this, path, state)\n    const n = this._findAdjacentN(action) // automatically determine if the user is just going back or next to a URL already visited\n\n    if (n) return this.jump(n, false, undefined, { state }, notify)\n\n    const kind = n === -1 ? 'back' : n === 1 ? 'next' : 'push'\n    const index = n === -1 ? this.index - 1 : this.index + 1\n    const entries = this._pushToFront(action, this.entries, index, kind)\n    const info = { kind, index, entries }\n    const awaitUrl = this.url\n    const commit = (action) => this._push(action, awaitUrl)\n\n    return this._notify(action, info, commit, notify)\n  }\n\n  replace(path, state = path.state || {}, notify = true) {\n    const action = toAction(this, path, state)\n    const n = this._findAdjacentN(action) // automatically determine if the user is just going back or next to a URL already visited\n\n    if (n) return this.jump(n, false, undefined, { state }, notify)\n\n    const kind = n === -1 ? 'back' : n === 1 ? 'next' : 'replace'\n    const { index } = this\n    const entries = this.entries.slice(0)\n    const info = { kind, entries, index }\n    const currUrl = this.url\n    const commit = (action) => this._replace(action, currUrl)\n\n    entries[index] = action\n\n    return this._notify(action, info, commit, notify)\n  }\n\n  jump(delta, byIndex = false, n, act, notify = true, revertPop) {\n    delta = this._resolveDelta(delta, byIndex)\n    n = n || (delta < 0 ? -1 : 1) // users can choose what direction to make the `jump` look like it came from\n\n    const kind = delta === -1 ? 'back' : delta === 1 ? 'next' : 'jump' // back/next kinds are just more specifically named jumps\n    const isMovingAdjacently = kind !== 'jump'\n    const isPop = !!revertPop // passed by BrowserHistory's `handlePop`\n    const index = this.index + delta\n    const entries = this.entries.slice(0)\n\n    if (!this.entries[index]) {\n      throw new Error(`[rudy] jump() - no entry at index: ${index}.`)\n    }\n\n    const action = (entries[index] = this._transformEntry(\n      this.entries[index],\n      act,\n    ))\n    const info = { kind, index, entries, n }\n\n    const currentEntry = isMovingAdjacently && this.entries[this.index] // for `replace` to adjacent entries we need to override `prev` to be the current entry; `push` doesn't have this issue, but their `prev` value is the same\n    const prev = this._createPrev(info, currentEntry) // jumps can fake the value of `prev` state\n\n    const currUrl = this.url\n    const oldUrl = this.entries[index].location.url\n    const commit = (action) => this._jump(action, currUrl, oldUrl, delta, isPop)\n\n    return this._notify(action, info, commit, notify, { prev, revertPop })\n  }\n\n  back(state, notify = true) {\n    return this.jump(-1, false, -1, { state }, notify)\n  }\n\n  next(state, notify = true) {\n    return this.jump(1, false, 1, { state }, notify)\n  }\n\n  set(act, delta, byIndex = false, notify = true) {\n    delta = this._resolveDelta(delta, byIndex)\n\n    const kind = 'set'\n    const { index } = this\n    const i = this.index + delta\n    const entries = this.entries.slice(0)\n\n    if (!this.entries[i]) {\n      throw new Error(`[rudy] set() - no entry at index: ${i}`)\n    }\n\n    const entry = (entries[i] = this._transformEntry(this.entries[i], act))\n    const action = delta === 0 ? entry : createActionRef(this.location) // action dispatched must ALWAYS be current one, but insure it receives changes if delta === 0, not just entry in entries\n    const info = { kind, index, entries }\n\n    const oldUrl = delta === 0 ? this.url : this.entries[i].location.url // this must be the current URL for the target so that `BrowserHistory` url awaiting works, as the target's URL may change in `this._transformEntry`\n    const commit = (action) => this._set(action, oldUrl, delta)\n\n    if (i === this.location.prev.location.index) {\n      action.prev = { ...entry, location: { ...entry.location, index: i } } // edge case: insure `state.prev` matches changed entry IF CHANGED ENTRY HAPPENS TO ALSO BE THE PREV\n    }\n\n    return this._notify(action, info, commit, notify)\n  }\n\n  replacePop(path, state = {}, notify = true, info) {\n    const action = toAction(this, path, state)\n    const { index, prevUrl, n } = info\n    const entries = info.entries.slice(0)\n    const kind = index < this.index ? 'back' : 'next'\n    const newInfo = { kind, entries, index }\n\n    const commit = (action) => this._replace(action, prevUrl, n)\n\n    entries[index] = action\n\n    return this._notify(action, newInfo, commit, notify)\n  }\n\n  reset(ents, i, n, notify = true) {\n    if (ents.length === 1) {\n      const entry = this._findResetFirstAction(ents[0]) // browser must always have at least 2 entries, so one can be pushed, erasing old entries from the stack\n      ents.unshift(entry)\n    }\n\n    i = i !== undefined ? i : ents.length - 1\n\n    n =\n      n ||\n      (i !== ents.length - 1\n        ? i > this.index\n          ? 1\n          : i === this.index\n            ? this.n\n            : -1 // create direction relative to index of current entries\n        : 1) // at the front of the array, always use \"forward\" direction\n\n    const kind = 'reset'\n    const { index, entries } = toEntries(this, ents, i, n)\n    const action = { ...entries[index] }\n    const info = { kind, index, entries, n }\n    const oldUrl = this.url\n    const oldFirstUrl = this.entries[0].location.url\n    const reverseN = -this.index\n    const commit = (action) =>\n      this._reset(action, oldUrl, oldFirstUrl, reverseN)\n\n    if (!entries[index]) throw new Error(`[rudy] no entry at index: ${index}.`)\n\n    const prev = this._createPrev(info)\n    const from = index === this.index && createActionRef(this.location) // if index stays the same, treat as \"replace\"\n\n    return this._notify(action, info, commit, notify, { prev, from })\n  }\n\n  canJump(delta, byIndex) {\n    delta = this._resolveDelta(delta, byIndex)\n    return !!this.entries[this.index + delta]\n  }\n\n  // UTILS:\n\n  _transformEntry(entry, action) {\n    entry = { ...entry }\n\n    if (typeof action === 'function') {\n      return toAction(this, action(entry))\n    }\n\n    action = isAction(action) ? action : { state: action }\n    let { params, query, state, hash, basename: bn } = action\n\n    if (params) {\n      params = typeof params === 'function' ? params(entry.query) : params\n      entry.params = { ...entry.params, ...params }\n    }\n\n    if (query) {\n      query = typeof query === 'function' ? query(entry.query) : query\n      entry.query = { ...entry.query, ...query }\n    }\n\n    if (state) {\n      state = typeof state === 'function' ? state(entry.state) : state\n\n      entry.state = { ...entry.state, ...state }\n    }\n\n    if (hash) {\n      hash = typeof hash === 'function' ? hash(entry.hash) : hash\n      entry.hash = hash\n    }\n\n    if (bn) {\n      bn = typeof bn === 'function' ? bn(entry.basename) : bn\n      entry.basename = bn\n    }\n\n    return toAction(this, entry)\n  }\n\n  _createPrev({ n, index: i, entries }, currentEntry) {\n    const index = i - n // reverse of n direction to get prev\n    const entry = currentEntry || entries[index]\n\n    if (!entry) return createPrevEmpty()\n\n    const scene = this.routes[entry.type].scene || ''\n    const action = { ...entry, location: { ...entry.location, index, scene } }\n\n    return createActionRef(action) // build the action for that entry, and create what the resulting state shape would have looked like\n  }\n\n  _findResetFirstAction(entry) {\n    const { routes, options } = this\n\n    // the user can configure what the default first entry is\n    if (options.resetFirstEntry) {\n      return typeof options.resetFirstEntry === 'function'\n        ? options.resetFirstEntry(entry)\n        : options.resetFirstEntry\n    }\n\n    // if not, we have little choice but to put a HOME or NOT_FOUND action at the front of the entries\n    if (typeof entry === 'object' && entry.type) {\n      const action = entry\n\n      if (routes[action.type].path !== '/') {\n        const homeType = Object.keys(routes).find(\n          (type) => routes[type].path === '/',\n        )\n        return homeType ? { type: homeType } : { type: 'NOT_FOUND' }\n      }\n\n      return { type: 'NOT_FOUND' }\n    }\n\n    // entries may also be supplied as paths or arrays also containing state, eg:  [[path, state], [path, state]]\n    const path = Array.isArray(entry) ? entry[0] : entry\n    const notFoundPath = routes.NOT_FOUND.path\n\n    if (path !== '/') {\n      const homeRoute = Object.keys(routes).find(\n        (type) => routes[type].path === '/',\n      )\n      return homeRoute ? '/' : notFoundPath\n    }\n\n    return notFoundPath\n  }\n\n  _once(commit) {\n    let committed = false\n\n    return (action) => {\n      if (committed) return Promise.resolve()\n      committed = true\n\n      return Promise.resolve(commit(action)).then(() => {\n        if (!this.options.save) return\n        this.options.save(this.location) // will retreive these from redux state, which ALWAYS updates first\n      })\n    }\n  }\n\n  _findAdjacentN(action) {\n    return this._findBackN(action) || this._findNextN(action)\n  }\n\n  _findBackN(action) {\n    const e = this.entries[this.index - 1]\n    return e && e.location.url === action.location.url && -1\n  }\n\n  _findNextN(action) {\n    const e = this.entries[this.index + 1]\n    return e && e.location.url === action.location.url && 1\n  }\n\n  _pushToFront(action, prevEntries, index) {\n    const entries = prevEntries.slice(0)\n    const isBehindHead = entries.length > index\n\n    if (isBehindHead) {\n      const entriesToDelete = entries.length - index\n      entries.splice(index, entriesToDelete, action)\n    } else {\n      entries.push(action)\n    }\n\n    return entries\n  }\n\n  _resolveDelta(delta, byIndex) {\n    if (typeof delta === 'string') {\n      const index = this.entries.findIndex((e) => e.location.key === delta)\n      return index - this.index\n    }\n\n    if (byIndex) {\n      return delta - this.index\n    }\n\n    return delta || 0\n  }\n\n  // All child classes *should* implement this:\n  _restore() {\n    return toEntries(this) // by default creates action array for a single entry: ['/']\n  }\n\n  // BrowseHistory (or 3rd party implementations) override these to provide sideFX\n  _push() {}\n\n  _replace() {}\n\n  _jump() {}\n\n  _set() {}\n\n  _reset() {}\n}\n"],"file":"History.js"}